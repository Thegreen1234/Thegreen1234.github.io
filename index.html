<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>永續商店地圖 - 後台管理</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f0f7f4;
        }
        .container {
            max-width: 1200px;
        }
        input[type="text"], input[type="number"], input[type="email"], textarea {
            border: 1px solid #d1d5db;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            width: 100%;
            box-sizing: border-box;
        }
        .btn-primary {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
        }
        .btn-red {
            background-color: #ef4444;
            transition: all 0.3s ease;
        }
        .btn-red:hover {
            background-color: #dc2626;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }
        .table-header th {
            padding: 0.75rem 1rem;
            text-align: left;
            font-weight: 600;
            background-color: #e0f2f7;
            color: #1e40af;
        }
        .table-row td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e5e7eb;
        }
        .table-row:nth-child(odd) {
            background-color: #f9fafb;
        }
        .table-row:hover {
            background-color: #f3f4f6;
        }
    </style>
</head>
<body>
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">永續商店管理後台</h1>

        <div class="bg-white p-6 rounded-lg shadow-md mb-8">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4" id="form-title">新增商店</h2>
            <form id="shop-form" class="space-y-4">
                <input type="hidden" id="shop-id">
                <div>
                    <label for="name-zh" class="block text-gray-700 text-sm font-bold mb-2">商店名稱 (繁體中文):</label>
                    <input type="text" id="name-zh" required>
                </div>
                <div>
                    <label for="name-en" class="block text-gray-700 text-sm font-bold mb-2">商店名稱 (English):</label>
                    <input type="text" id="name-en" required>
                </div>
                <div>
                    <label for="name-fr" class="block text-gray-700 text-sm font-bold mb-2">商店名稱 (Français):</label>
                    <input type="text" id="name-fr" required>
                </div>
                <div>
                    <label for="name-de" class="block text-gray-700 text-sm font-bold mb-2">商店名稱 (Deutsch):</label>
                    <input type="text" id="name-de" required>
                </div>
                <div>
                    <label for="name-es" class="block text-gray-700 text-sm font-bold mb-2">商店名稱 (Español):</label>
                    <input type="text" id="name-es" required>
                </div>
                <div>
                    <label for="type-zh" class="block text-gray-700 text-sm font-bold mb-2">類型 (繁體中文):</label>
                    <input type="text" id="type-zh" required placeholder="例如：家居用品, 無包裝商店">
                </div>
                <div>
                    <label for="type-en" class="block text-gray-700 text-sm font-bold mb-2">類型 (English):</label>
                    <input type="text" id="type-en" required placeholder="e.g., Home Goods, Zero-Waste Store">
                </div>
                <div>
                    <label for="type-fr" class="block text-gray-700 text-sm font-bold mb-2">類型 (Français):</label>
                    <input type="text" id="type-fr" required placeholder="ex: Articles ménagers, Magasin zéro déchet">
                </div>
                <div>
                    <label for="type-de" class="block text-gray-700 text-sm font-bold mb-2">類型 (Deutsch):</label>
                    <input type="text" id="type-de" required placeholder="z.B. Haushaltswaren, Unverpackt-Laden">
                </div>
                <div>
                    <label for="type-es" class="block text-gray-700 text-sm font-bold mb-2">類型 (Español):</label>
                    <input type="text" id="type-es" required placeholder="ej: Artículos para el hogar, Tienda sin envases">
                </div>
                <div>
                    <label for="address-zh" class="block text-gray-700 text-sm font-bold mb-2">地址 (繁體中文):</label>
                    <input type="text" id="address-zh" required>
                </div>
                <div>
                    <label for="address-en" class="block text-gray-700 text-sm font-bold mb-2">地址 (English):</label>
                    <input type="text" id="address-en" required>
                </div>
                <div>
                    <label for="address-fr" class="block text-gray-700 text-sm font-bold mb-2">地址 (Français):</label>
                    <input type="text" id="address-fr" required>
                </div>
                <div>
                    <label for="address-de" class="block text-gray-700 text-sm font-bold mb-2">地址 (Deutsch):</label>
                    <input type="text" id="address-de" required>
                </div>
                <div>
                    <label for="address-es" class="block text-gray-700 text-sm font-bold mb-2">地址 (Español):</label>
                    <input type="text" id="address-es" required>
                </div>
                <div>
                    <label for="hours-zh" class="block text-gray-700 text-sm font-bold mb-2">營業時間 (繁體中文):</label>
                    <input type="text" id="hours-zh" required placeholder="例如：每日 10:00 - 20:00">
                </div>
                <div>
                    <label for="hours-en" class="block text-gray-700 text-sm font-bold mb-2">營業時間 (English):</label>
                    <input type="text" id="hours-en" required placeholder="e.g., Daily 10:00 AM - 8:00 PM">
                </div>
                <div>
                    <label for="hours-fr" class="block text-gray-700 text-sm font-bold mb-2">營業時間 (Français):</label>
                    <input type="text" id="hours-fr" required placeholder="ex: Tous les jours 10h00 - 20h00">
                </div>
                <div>
                    <label for="hours-de" class="block text-gray-700 text-sm font-bold mb-2">營業時間 (Deutsch):</label>
                    <input type="text" id="hours-de" required placeholder="z.B. Täglich 10:00 - 20:00 Uhr">
                </div>
                <div>
                    <label for="hours-es" class="block text-gray-700 text-sm font-bold mb-2">營業時間 (Español):</label>
                    <input type="text" id="hours-es" required placeholder="ej: Diario 10:00 - 20:00">
                </div>
                <div>
                    <label for="phone" class="block text-gray-700 text-sm font-bold mb-2">電話:</label>
                    <input type="text" id="phone">
                </div>
                <div>
                    <label for="email" class="block text-gray-700 text-sm font-bold mb-2">Email:</label>
                    <input type="email" id="email">
                </div>
                <div>
                    <label for="website" class="block text-gray-700 text-sm font-bold mb-2">網站:</label>
                    <input type="text" id="website" placeholder="例如：example.com">
                </div>
                <div>
                    <label for="description-zh" class="block text-gray-700 text-sm font-bold mb-2">簡短描述 (繁體中文):</label>
                    <textarea id="description-zh" rows="2" required></textarea>
                </div>
                <div>
                    <label for="description-en" class="block text-gray-700 text-sm font-bold mb-2">簡短描述 (English):</label>
                    <textarea id="description-en" rows="2" required></textarea>
                </div>
                <div>
                    <label for="description-fr" class="block text-gray-700 text-sm font-bold mb-2">簡短描述 (Français):</label>
                    <textarea id="description-fr" rows="2" required></textarea>
                </div>
                <div>
                    <label for="description-de" class="block text-gray-700 text-sm font-bold mb-2">簡短描述 (Deutsch):</label>
                    <textarea id="description-de" rows="2" required></textarea>
                </div>
                <div>
                    <label for="description-es" class="block text-gray-700 text-sm font-bold mb-2">簡短描述 (Español):</label>
                    <textarea id="description-es" rows="2" required></textarea>
                </div>
                <div>
                    <label for="longDescription-zh" class="block text-gray-700 text-sm font-bold mb-2">詳細描述 (繁體中文):</label>
                    <textarea id="longDescription-zh" rows="4"></textarea>
                </div>
                <div>
                    <label for="longDescription-en" class="block text-gray-700 text-sm font-bold mb-2">詳細描述 (English):</label>
                    <textarea id="longDescription-en" rows="4"></textarea>
                </div>
                <div>
                    <label for="longDescription-fr" class="block text-gray-700 text-sm font-bold mb-2">詳細描述 (Français):</label>
                    <textarea id="longDescription-fr" rows="4"></textarea>
                </div>
                <div>
                    <label for="longDescription-de" class="block text-gray-700 text-sm font-bold mb-2">詳細描述 (Deutsch):</label>
                    <textarea id="longDescription-de" rows="4"></textarea>
                </div>
                <div>
                    <label for="longDescription-es" class="block text-gray-700 text-sm font-bold mb-2">詳細描述 (Español):</label>
                    <textarea id="longDescription-es" rows="4"></textarea>
                </div>
                <div>
                    <label for="sustainability-zh" class="block text-gray-700 text-sm font-bold mb-2">永續理念 (繁體中文):</label>
                    <textarea id="sustainability-zh" rows="3"></textarea>
                </div>
                <div>
                    <label for="sustainability-en" class="block text-gray-700 text-sm font-bold mb-2">永續理念 (English):</label>
                    <textarea id="sustainability-en" rows="3"></textarea>
                </div>
                <div>
                    <label for="sustainability-fr" class="block text-gray-700 text-sm font-bold mb-2">永續理念 (Français):</label>
                    <textarea id="sustainability-fr" rows="3"></textarea>
                </div>
                <div>
                    <label for="sustainability-de" class="block text-gray-700 text-sm font-bold mb-2">永續理念 (Deutsch):</label>
                    <textarea id="sustainability-de" rows="3"></textarea>
                </div>
                <div>
                    <label for="sustainability-es" class="block text-gray-700 text-sm font-bold mb-2">永續理念 (Español):</label>
                    <textarea id="sustainability-es" rows="3"></textarea>
                </div>
                <div>
                    <label for="tags-zh" class="block text-gray-700 text-sm font-bold mb-2">標籤 (繁體中文，用逗號分隔):</label>
                    <input type="text" id="tags-zh" placeholder="例如：零廢棄, 環保生活">
                </div>
                <div>
                    <label for="tags-en" class="block text-gray-700 text-sm font-bold mb-2">標籤 (English, comma separated):</label>
                    <input type="text" id="tags-en" placeholder="e.g., Zero-Waste, Eco-friendly Living">
                </div>
                <div>
                    <label for="tags-fr" class="block text-gray-700 text-sm font-bold mb-2">標籤 (Français, séparés par des virgules):</label>
                    <input type="text" id="tags-fr" placeholder="ex: Zéro déchet, Vie écologique">
                </div>
                <div>
                    <label for="tags-de" class="block text-gray-700 text-sm font-bold mb-2">標籤 (Deutsch, Komma getrennt):</label>
                    <input type="text" id="tags-de" placeholder="z.B. Zero Waste, Umweltfreundliches Leben">
                </div>
                <div>
                    <label for="tags-es" class="block text-gray-700 text-sm font-bold mb-2">標籤 (Español, separados por comas):</label>
                    <input type="text" id="tags-es" placeholder="ej: Cero residuos, Vida ecológica">
                </div>
                <div>
                    <label for="lat" class="block text-gray-700 text-sm font-bold mb-2">緯度 (Latitude):</label>
                    <input type="number" step="any" id="lat" required>
                </div>
                <div>
                    <label for="lng" class="block text-gray-700 text-sm font-bold mb-2">經度 (Longitude):</label>
                    <input type="number" step="any" id="lng" required>
                </div>
                <div>
                    <button type="submit" class="btn-primary text-white font-bold py-2 px-4 rounded w-full">儲存商店</button>
                    <button type="button" id="cancel-edit" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded w-full mt-2 hidden">取消編輯</button>
                </div>
            </form>
        </div>

        <div class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">商店列表</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full bg-white">
                    <thead>
                        <tr class="table-header">
                            <th>名稱 (中文)</th>
                            <th>類型 (中文)</th>
                            <th>地址 (中文)</th>
                            <th>電話</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="shops-list">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <script type="module">
        // Firebase 模組導入
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
        import { getFirestore, collection, onSnapshot, addDoc, doc, updateDoc, deleteDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";

        // Firebase 配置 (請替換為您自己的配置)
        const firebaseConfig = {
          apiKey: "AIzaSyBe4RmOd4K3L8oVlANLX_1xmAyhsY0eB4k",
          authDomain: "green-1de30.firebaseapp.com",
          projectId: "green-1de30",
          storageBucket: "green-1de30.firebasestorage.app",
          messagingSenderId: "761812308263",
          appId: "1:761812308263:web:d82a416652dd975dff5902",
          measurementId: "G-XG5VV6QMGB"
        };

        // 初始化 Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        let shopsCollectionRef; // Firestore 集合引用

        // Firebase 認證：使用 Canvas 環境提供的 token，否則匿名登入
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                // 如果是 Canvas 環境，使用 __app_id 構建集合路徑
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                // 這裡的 'shops' 是 Firestore 集合的名稱
                // 請確保您在 Firebase Console 的 Firestore Database 中建立了一個名為 'shops' 的集合
                // 如果您的應用程式是在 Canvas 環境中部署，路徑會是 `artifacts/${appId}/public/data/shops`
                // 否則，您可以直接使用 `collection(db, "shops")`
                shopsCollectionRef = collection(db, `artifacts/${appId}/public/data/shops`); 
                console.log("Firebase authenticated as:", user.uid);
                console.log("Firestore collection path:", shopsCollectionRef.path);
                setupFirestoreListener(); // 認證成功後設定 Firestore 監聽器
            } else {
                console.log("No user signed in. Attempting anonymous sign-in.");
                try {
                    // 檢查 __initial_auth_token 是否存在
                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                        await signInWithCustomToken(auth, __initial_auth_token);
                    } else {
                        await signInAnonymously(auth);
                    }
                } catch (error) {
                    console.error("Firebase authentication failed:", error);
                    alert("Firebase 認證失敗，無法連接到資料庫。請檢查網路或專案設定。"); // 使用 alert 提示管理員
                }
            }
        });

        const shopForm = document.getElementById('shop-form');
        const shopIdInput = document.getElementById('shop-id');
        const formTitle = document.getElementById('form-title');
        const shopsList = document.getElementById('shops-list');
        const cancelButton = document.getElementById('cancel-edit');

        let currentShopsData = []; // 用於儲存從 Firestore 獲取的商店數據

        // Firestore 數據監聽器
        function setupFirestoreListener() {
            if (!shopsCollectionRef) {
                console.error("Firestore collection reference is not set.");
                return;
            }
            onSnapshot(shopsCollectionRef, (snapshot) => {
                currentShopsData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                console.log("Firestore data updated:", currentShopsData);
                renderShopsList(); // 數據更新後重新渲染列表
            }, (error) => {
                console.error("Error listening to Firestore:", error);
                alert("無法載入商店數據，請檢查網路連線或 Firestore 規則。"); // 使用 alert 提示管理員
            });
        }

        // 渲染商店列表
        function renderShopsList() {
            shopsList.innerHTML = ''; // 清空列表
            currentShopsData.forEach(shop => {
                const row = document.createElement('tr');
                row.className = 'table-row';
                row.innerHTML = `
                    <td>${shop.name['zh-TW'] || ''}</td>
                    <td>${shop.type['zh-TW'] || ''}</td>
                    <td>${shop.address['zh-TW'] || ''}</td>
                    <td>${shop.phone || '未提供'}</td>
                    <td class="whitespace-nowrap">
                        <button onclick="editShop('${shop.id}')" class="bg-blue-500 hover:bg-blue-700 text-white text-xs font-bold py-1 px-2 rounded mr-1">編輯</button>
                        <button onclick="deleteShop('${shop.id}')" class="btn-red text-white text-xs font-bold py-1 px-2 rounded">刪除</button>
                    </td>
                `;
                shopsList.appendChild(row);
            });
        }

        // 提交表單（新增或更新商店）
        shopForm.addEventListener('submit', async function(event) {
            event.preventDefault(); // 阻止表單預設提交行為

            const id = shopIdInput.value;
            const shopDataToSave = {
                name: { 
                    'zh-TW': document.getElementById('name-zh').value, 
                    'en': document.getElementById('name-en').value,
                    'fr': document.getElementById('name-fr').value,
                    'de': document.getElementById('name-de').value,
                    'es': document.getElementById('name-es').value
                },
                type: { 
                    'zh-TW': document.getElementById('type-zh').value, 
                    'en': document.getElementById('type-en').value,
                    'fr': document.getElementById('type-fr').value,
                    'de': document.getElementById('type-de').value,
                    'es': document.getElementById('type-es').value
                },
                address: { 
                    'zh-TW': document.getElementById('address-zh').value, 
                    'en': document.getElementById('address-en').value,
                    'fr': document.getElementById('address-fr').value,
                    'de': document.getElementById('address-de').value,
                    'es': document.getElementById('address-es').value
                },
                hours: { 
                    'zh-TW': document.getElementById('hours-zh').value, 
                    'en': document.getElementById('hours-en').value,
                    'fr': document.getElementById('hours-fr').value,
                    'de': document.getElementById('hours-de').value,
                    'es': document.getElementById('hours-es').value
                },
                phone: document.getElementById('phone').value || null,
                email: document.getElementById('email').value || null,
                website: document.getElementById('website').value || null,
                description: { 
                    'zh-TW': document.getElementById('description-zh').value, 
                    'en': document.getElementById('description-en').value,
                    'fr': document.getElementById('description-fr').value,
                    'de': document.getElementById('description-de').value,
                    'es': document.getElementById('description-es').value
                },
                longDescription: { 
                    'zh-TW': document.getElementById('longDescription-zh').value, 
                    'en': document.getElementById('longDescription-en').value,
                    'fr': document.getElementById('longDescription-fr').value,
                    'de': document.getElementById('longDescription-de').value,
                    'es': document.getElementById('longDescription-es').value
                },
                sustainability: { 
                    'zh-TW': document.getElementById('sustainability-zh').value, 
                    'en': document.getElementById('sustainability-en').value,
                    'fr': document.getElementById('sustainability-fr').value,
                    'de': document.getElementById('sustainability-de').value,
                    'es': document.getElementById('sustainability-es').value
                },
                tags: { 
                    'zh-TW': document.getElementById('tags-zh').value.split(',').map(tag => tag.trim()), 
                    'en': document.getElementById('tags-en').value.split(',').map(tag => tag.trim()),
                    'fr': document.getElementById('tags-fr').value.split(',').map(tag => tag.trim()),
                    'de': document.getElementById('tags-de').value.split(',').map(tag => tag.trim()),
                    'es': document.getElementById('tags-es').value.split(',').map(tag => tag.trim())
                },
                lat: parseFloat(document.getElementById('lat').value),
                lng: parseFloat(document.getElementById('lng').value)
            };

            try {
                if (id) {
                    // 更新現有商店
                    const shopDocRef = doc(shopsCollectionRef, id);
                    await updateDoc(shopDocRef, shopDataToSave);
                    console.log("Document updated with ID:", id);
                } else {
                    // 新增商店
                    const docRef = await addDoc(shopsCollectionRef, shopDataToSave);
                    console.log("Document written with ID:", docRef.id);
                }
                clearForm();
            } catch (e) {
                console.error("Error adding/updating document: ", e);
                alert("儲存商店失敗：" + e.message);
            }
        });

        // 清空表單
        function clearForm() {
            shopForm.reset();
            shopIdInput.value = '';
            formTitle.textContent = '新增商店';
            cancelButton.classList.add('hidden');
        }

        // 編輯商店 (從列表中載入數據到表單)
        window.editShop = async function(id) { // 設為全域函數以便 onclick 呼叫
            const shopDocRef = doc(shopsCollectionRef, id);
            try {
                const shopSnap = await getDoc(shopDocRef);
                if (shopSnap.exists()) {
                    const shop = shopSnap.data();
                    shopIdInput.value = shopSnap.id;
                    document.getElementById('name-zh').value = shop.name['zh-TW'] || '';
                    document.getElementById('name-en').value = shop.name['en'] || '';
                    document.getElementById('name-fr').value = shop.name['fr'] || '';
                    document.getElementById('name-de').value = shop.name['de'] || '';
                    document.getElementById('name-es').value = shop.name['es'] || '';
                    document.getElementById('type-zh').value = shop.type['zh-TW'] || '';
                    document.getElementById('type-en').value = shop.type['en'] || '';
                    document.getElementById('type-fr').value = shop.type['fr'] || '';
                    document.getElementById('type-de').value = shop.type['de'] || '';
                    document.getElementById('type-es').value = shop.type['es'] || '';
                    document.getElementById('address-zh').value = shop.address['zh-TW'] || '';
                    document.getElementById('address-en').value = shop.address['en'] || '';
                    document.getElementById('address-fr').value = shop.address['fr'] || '';
                    document.getElementById('address-de').value = shop.address['de'] || '';
                    document.getElementById('address-es').value = shop.address['es'] || '';
                    document.getElementById('hours-zh').value = shop.hours['zh-TW'] || '';
                    document.getElementById('hours-en').value = shop.hours['en'] || '';
                    document.getElementById('hours-fr').value = shop.hours['fr'] || '';
                    document.getElementById('hours-de').value = shop.hours['de'] || '';
                    document.getElementById('hours-es').value = shop.hours['es'] || '';
                    document.getElementById('phone').value = shop.phone || '';
                    document.getElementById('email').value = shop.email || '';
                    document.getElementById('website').value = shop.website || '';
                    document.getElementById('description-zh').value = shop.description['zh-TW'] || '';
                    document.getElementById('description-en').value = shop.description['en'] || '';
                    document.getElementById('description-fr').value = shop.description['fr'] || '';
                    document.getElementById('description-de').value = shop.description['de'] || '';
                    document.getElementById('description-es').value = shop.description['es'] || '';
                    document.getElementById('longDescription-zh').value = shop.longDescription['zh-TW'] || '';
                    document.getElementById('longDescription-en').value = shop.longDescription['en'] || '';
                    document.getElementById('longDescription-fr').value = shop.longDescription['fr'] || '';
                    document.getElementById('longDescription-de').value = shop.longDescription['de'] || '';
                    document.getElementById('longDescription-es').value = shop.longDescription['es'] || '';
                    document.getElementById('sustainability-zh').value = shop.sustainability['zh-TW'] || '';
                    document.getElementById('sustainability-en').value = shop.sustainability['en'] || '';
                    document.getElementById('sustainability-fr').value = shop.sustainability['fr'] || '';
                    document.getElementById('sustainability-de').value = shop.sustainability['de'] || '';
                    document.getElementById('sustainability-es').value = shop.sustainability['es'] || '';
                    document.getElementById('tags-zh').value = shop.tags['zh-TW'] ? shop.tags['zh-TW'].join(', ') : '';
                    document.getElementById('tags-en').value = shop.tags['en'] ? shop.tags['en'].join(', ') : '';
                    document.getElementById('tags-fr').value = shop.tags['fr'] ? shop.tags['fr'].join(', ') : '';
                    document.getElementById('tags-de').value = shop.tags['de'] ? shop.tags['de'].join(', ') : '';
                    document.getElementById('tags-es').value = shop.tags['es'] ? shop.tags['es'].join(', ') : '';
                    document.getElementById('lat').value = shop.lat || '';
                    document.getElementById('lng').value = shop.lng || '';

                    formTitle.textContent = '編輯商店';
                    cancelButton.classList.remove('hidden');
                } else {
                    alert("找不到該商店。");
                }
            } catch (error) {
                console.error("Error fetching document for edit:", error);
                alert("載入商店資料失敗：" + error.message);
            }
        }

        // 取消編輯
        cancelButton.addEventListener('click', clearForm);

        // 刪除商店
        window.deleteShop = async function(id) { // 設為全域函數以便 onclick 呼叫
            if (confirm('確定要刪除這家商店嗎？此操作無法恢復。')) {
                const shopDocRef = doc(shopsCollectionRef, id);
                try {
                    await deleteDoc(shopDocRef);
                    console.log("Document successfully deleted!");
                    clearForm();
                } catch (error) {
                    console.error("Error removing document: ", error);
                    alert("刪除商店失敗：" + error.message);
                }
            }
        }
    </script>
</body>
</html>
